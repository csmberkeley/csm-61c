\begin{blocksection}
\question
\begin{parts}
\part
Considering the standard 32-bit RISC-V instruction formats, convert lw t5, 17(t6) to machine code:
\begin{solution}
\begin{verbatim}
0x011FAF03
\end{verbatim}
		 	 	 								
Please refer to the RISC-V Green Card for this type of questions. lw is I-ype instruc- tion. Its funct3 field is 010, opcode is 0000011. The address offset 17 is 0b10001 in binary (0b means in binary). rs1 is t6 →− x31 →− 0b11111. rd is t5 →− x30 →− 0b11110. Altogether, we have 0b000000010001-11111-010-11110-0000011→− 0b0000-0001-0001- 1111-1010-1111-0000-0011 →− 0x011FAF03
\end{solution}

Prof. Wawrzynek decides to design a new ISA for his ternary neural network accelerator. He only needs to perform 7 different operations with his ISA: XOR, ADD, LD, SW, LUI, ADDI, and BLT. He decides that each instruction should be 17 bits wide, as he likes the number 17. There are no funct7 or funct3 fields in this new ISA.

\part What is the minimum number of bits required for the opcode field?
\begin{solution}
$\ceil{\log_2 7} = 3$

Binary encoding, which requires least number of bits, is used here. In order to represent 7 operations, we need at least $\ceil{\log_2 7} = 3$ bits.
\end{solution}

\part
Suppose Prof. Wawrzynek decides to make the opcode field 6 bits. If we would like to support instructions with 3 register fields, what is the maximum number of registers we could address?
\begin{solution}
The instruction is 17 bit wide, 6 bits are used for opcode, we have 11 bits left for register indexing. Given we need 3 register fields, we can have ⌊11/3⌋ = 3 bits per register field which means we could address 8 registers.
\end{solution}

\part
Given that the opcode field is 6 bits wide and each register field is 2 bits wide in the 17 bit instruction, answer the following questions: 
\begin{parts}
\part
Using the assumptions stated in the description of part (d), how many bits are left for the immediate field for the instruction BLT (Assume it takes opcode, rs1, rs2, and imm as inputs)?
\begin{solution}
$17 - 6 - 2 - 2 = 7$ \\
BLT has 1 opcode field $(-6)$, 2 register fields $(-2-2)$, we can use the rest $17-6-2-2 = 7$ bits for expressing jump offset.
\end{solution}

\part
Let n be your answer in part (i). Suppose that BLT’s branch immediate is in units of instructions (i.e. an immediate of value 1 means branching 1 instruction away). What is the maximum number of bits a BLT instruction can jump forward from the current PC using these assumptions? Write your answer in terms of n.
\begin{solution}
$(2^{n - 1} − 1) ∗ 17$ \\
In 2’s complement, the range of an $n$-bit number is $[−2n−1, 2n−1 − 1]$. jumping forward means that the offset is positive. With $n$-bit 2’s complement offset, we can jump forward $2n−1 − 1$ instructions, which is $(2n−1 − 1) ∗ 17$ bits since each instruction is 17 bits wide.
\end{solution}

\part
Using the assumptions stated in the description of part (d), what is the most negative immediate that could be used in the ADDI instruction (Assume it takes opcode, rs1, rd, and imm as inputs)?
\begin{solution}
$-64$ \\
First, calculate the bit width of the immediate field, which is $17 − 6 − 2 − 2 = 7$ bits. The range of a 7-bit number in 2’s complement is $[−26, 26 − 1]$ Thus, the most negative immediate is $−26 = −64$.
\end{solution}

\part
For LUI, we need opcode, rd, and imm as inputs. Using the assumptions stated in the description of part (d), how many bits can we use for the immediate value?
\begin{solution}
$17-6-2 = 9$ \\
Given the opcode is 6 bits wide, register is 2 bits wide, we can use the rest of the bits for immediate. The width of immediate is therefore $17 − 6 − 2 = 9$.
\end{solution}

\end{parts}
\end{parts}
\end{blocksection}